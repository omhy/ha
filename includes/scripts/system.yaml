ha_set_defaults:
  sequence:
    - service: input_number.set_value
      entity_id: input_number.doorbell_volume
      data_template:
        value: 13
    - service: input_number.set_value
      entity_id: input_number.doorbell_melody
      data_template:
        value: 10
    - service: input_number.set_value
      entity_id: input_number.flow_transition
      data_template:
        value: 3
    - service: input_number.set_value
      entity_id: input_number.flow_brightness
      data_template:
        value: 250
    - service: input_number.set_value
      entity_id: input_number.flow_saturation
      data_template:
        value: 90

ha_update_state_timestamp:
  sequence:
    - service: script.mqtt_publish_retain
      data_template:
        topic: "ha_state_change"
        payload: "{{ now().strftime('%Y%m%d%H%M%S') }}"

ha_snapshot_create:
  sequence:
    - service: hassio.snapshot_full
      data_template:
        name: "backup_{{ now().strftime('%Y%m%d%_H%M%S') }}"

ha_snapshot_to_dropbox:
  sequence:
    - service: hassio.addon_stdin
      data:
        addon: "7be23ff5_dropbox_sync"
        input: {"command":"upload"}

###  AQARA
aqara_stop_ringtone:
  sequence:
    - service: xiaomi_aqara.stop_ringtone
      data_template:
        gw_mac: !secret gw_mac

aqara_add_device:
  sequence:
    - service: xiaomi_aqara.add_device
      data_template:
        gw_mac: !secret gw_mac

### MISC
rmt_computer_sleep:
  sequence:
    - service: shell_command.sleep_computer
rmt_laptop_sleep:
  sequence:
      - service: shell_command.sleep_laptop

alarm_door:
  sequence:
    - service: xiaomi_aqara.play_ringtone
      data_template:
        gw_mac: !secret gw_mac
        ringtone_id: "8"
        ringtone_vol: "10"
    - service: notify.telegram_all
      data_template:
        message: "{{ now().strftime('%H:%M') }} \U0001F6A8 Door opened for a while"

remove_file:
  sequence:
    - service: shell_command.remove_file
      data:
        rtsp: !secret cam1_rtsp
        filename: "/share/cam1.mp4"
        duration: "10"