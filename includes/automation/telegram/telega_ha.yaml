- alias: "ha_start"
  trigger:
    - platform: homeassistant
      event: start
  action:
    - service: telegram_bot.send_message
      data_template:
        target: !secret tg_chat_dima
        message: "{{ states.sensor.now_hm.state }} \U0001F916 {{ states.sensor.version_ha_current.state }} #HA is back online. Temp: {{ states.sensor.temp.state_with_unit }}"
        inline_keyboard:
          - "\U0001F532 Menu:/menu, \U0000267B Dismiss:/dismiss"

- alias: "ha_shutdown"
  trigger:
    - platform: homeassistant
      event: shutdown
  action:
    - service: telegram_bot.send_message
      data_template:
        target: !secret tg_chat_dima
        message: "{{ states.sensor.now_hm.state }} \U0001F6D1 {{ states.sensor.version_ha_current.state }} #HA goes offline (uptime {{ (24 * states.sensor.uptime.state | float) | round(2) }} h)"
        inline_keyboard:
          - "\U0000267B Dismiss:/dismiss"

- alias: "ha_bad_login"
  trigger:
    - platform: state
      entity_id: persistent_notification.httplogin
  condition:
    - condition: template
      value_template: "{{ trigger.to_state.state == 'notifying' }}"
  action:
    - service: telegram_bot.send_message
      data_template:
        target: !secret tg_chat_dima
        message: "{{ states.sensor.now_hm.state }} \U00002620 {{ states.persistent_notification.httplogin.attributes.message }}"
        inline_keyboard:
          - "\U0000267B Dismiss:/dismiss"
    - service: persistent_notification.dismiss
      data:
        notification_id: "httplogin"

- alias: "google_cast_updated"
  trigger:
    - platform: state
      entity_id:
        - sensor.cast_version_black_speaker
        - sensor.cast_version_chromecast
        - sensor.cast_version_kitchen_display
        - sensor.cast_version_loud_speaker
        - sensor.cast_version_yuri_speaker
  action:
    - service: telegram_bot.send_message
      data_template:
        target: !secret tg_chat_dima
        message: "{{ states.sensor.now_hm.state }} \U00002B06 `{{ trigger.from_state.attributes.friendly_name }}` updated {{ trigger.from_state.state }} -> {{ trigger.to_state.state }}"
        inline_keyboard:
          - "\U0000267B Dismiss:/dismiss"